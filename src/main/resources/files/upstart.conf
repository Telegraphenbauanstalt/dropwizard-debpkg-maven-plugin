description "{{{project.name}}} - {{{project.description}}}"

start on filesystem
stop on runlevel S

respawn
respawn limit 5 10
oom never

setuid "{{{unix.user}}}"
setgid "{{{unix.user}}}"

script
    JAVA_OPTS=$(sed -e '/^[[:space:]]*\/\//d' -e 's|[[:space:]]*//.*| |' -e 's|^| |' {{{path.jvmConfigFile}}} | tr -d "\n")
    JAVA_CMD="java ${JAVA_OPTS} -jar {{{path.jarFile}}} server {{{path.configFile}}}"

    logger -is -t "${UPSTART_JOB}" "[`date -u +%Y-%m-%dT%T.%3NZ`] Starting {{{project.name}}}"
    exec ${JAVA_CMD} >> {{{path.logDirectory}}}/upstart.log 2>&1
end script

pre-stop script
    logger -is -t "${UPSTART_JOB}" "[`date -u +%Y-%m-%dT%T.%3NZ`] Stopping {{{project.name}}}"
end script
